# implement.yaml - Implementation Workflow Recipe
#
# This recipe implements a plan by executing its phases sequentially,
# running tests, and validating the implementation.
#
# Usage: goose run --recipe implement.yaml

version: "1.0.0"
title: "Implement Plan"
description: "Execute an implementation plan phase by phase with testing and validation"

parameters:
  - key: plan_file
    input_type: string
    requirement: required
    description: "Path to the implementation plan file"

  - key: starting_phase
    input_type: number
    requirement: optional
    default: 1
    description: "Phase number to start from (for resuming)"

instructions: |
  You are executing an implementation plan. Your goal is to implement each phase
  of the plan, run tests, and validate the implementation.

  ## Input
  - Plan: {{ plan_file }}
  - Starting Phase: {{ starting_phase }}

  ## Implementation Steps

  ### Step 1: Read the Plan
  Load and parse the implementation plan:
  1. Read the plan file at the specified path
  2. Extract the list of phases
  3. Identify success criteria and testing requirements
  4. Note any dependencies between phases

  ### Step 2: Execute Phases
  For each phase starting from {{ starting_phase }}:

  1. **Read Phase Details**: Understand the objective and tasks
  2. **Implement Changes**: Make the code changes described in the phase
  3. **Run Tests**: Execute any tests specified in the phase
  4. **Validate**: Verify the phase success criteria are met
  5. **Report Progress**: Summarize what was accomplished

  ### Step 3: Handle Failures
  If a phase fails:
  - Analyze the error or test failure
  - Attempt to fix the issue
  - Re-run validation
  - If still failing after 3 attempts, report the blocker

  ### Step 4: Complete Implementation
  After all phases are complete:
  1. Run the full test suite
  2. Verify all success criteria from the plan
  3. Report the final status

  ## Output Format
  For each phase, report:
  - Phase number and name
  - Changes made (files modified)
  - Test results
  - Status (completed/failed/blocked)

prompt: "Implement the plan at: {{ plan_file }}"
