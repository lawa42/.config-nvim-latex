# revise.yaml - Plan Revision Workflow Recipe
#
# This recipe revises an existing implementation plan based on new requirements
# or feedback, conducting research as needed.
#
# Usage: goose run --recipe revise.yaml

version: "1.0.0"
title: "Revise Plan"
description: "Research and revise an existing implementation plan with new requirements"

parameters:
  - key: existing_plan_path
    input_type: string
    requirement: required
    description: "Path to existing plan file to revise"

  - key: revision_details
    input_type: string
    requirement: required
    description: "Natural language description of revision requirements"

  - key: complexity
    input_type: number
    requirement: optional
    default: 2
    description: "Research complexity level (1-4)"

instructions: |
  You are revising an existing implementation plan based on new requirements.
  Your goal is to understand the changes needed and update the plan accordingly.

  ## Input
  - Existing Plan: {{ existing_plan_path }}
  - Revision Details: {{ revision_details }}
  - Complexity: {{ complexity }}

  ## Revision Steps

  ### Step 1: Read Existing Plan
  Load and understand the current plan:
  1. Read the plan file at the specified path
  2. Understand the current phases and structure
  3. Note the success criteria and testing approach
  4. Identify which parts may need to change

  ### Step 2: Analyze Revision Requirements
  Understand what needs to change:
  1. Parse the revision details
  2. Identify which phases are affected
  3. Determine if new phases are needed
  4. Check if any phases should be removed

  ### Step 3: Research (if needed)
  If the revision requires new information:
  1. Search the codebase for relevant context
  2. Understand new dependencies or constraints
  3. Document findings to inform the revision

  ### Step 4: Revise the Plan
  Update the plan with the revisions:

  **Preserve**:
  - Plan metadata format
  - Phase numbering structure
  - Testing and validation approach

  **Update**:
  - Phases affected by the revision
  - Success criteria if needed
  - Dependencies between phases

  **Add**:
  - New phases if required
  - Updated research summary section

  ### Step 5: Output Revised Plan
  Present the complete revised plan in markdown format.
  Clearly indicate what changed from the original.

prompt: "Revise the plan at {{ existing_plan_path }} with these changes: {{ revision_details }}"
